<!DOCTYPE html>
<html>
<head>
<title>README.md</title>
<meta http-equiv="Content-type" content="text/html;charset=UTF-8">

<style>
/* https://github.com/microsoft/vscode/blob/master/extensions/markdown-language-features/media/markdown.css */
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/

body {
	font-family: var(--vscode-markdown-font-family, -apple-system, BlinkMacSystemFont, "Segoe WPC", "Segoe UI", "Ubuntu", "Droid Sans", sans-serif);
	font-size: var(--vscode-markdown-font-size, 14px);
	padding: 0 26px;
	line-height: var(--vscode-markdown-line-height, 22px);
	word-wrap: break-word;
}

#code-csp-warning {
	position: fixed;
	top: 0;
	right: 0;
	color: white;
	margin: 16px;
	text-align: center;
	font-size: 12px;
	font-family: sans-serif;
	background-color:#444444;
	cursor: pointer;
	padding: 6px;
	box-shadow: 1px 1px 1px rgba(0,0,0,.25);
}

#code-csp-warning:hover {
	text-decoration: none;
	background-color:#007acc;
	box-shadow: 2px 2px 2px rgba(0,0,0,.25);
}

body.scrollBeyondLastLine {
	margin-bottom: calc(100vh - 22px);
}

body.showEditorSelection .code-line {
	position: relative;
}

body.showEditorSelection .code-active-line:before,
body.showEditorSelection .code-line:hover:before {
	content: "";
	display: block;
	position: absolute;
	top: 0;
	left: -12px;
	height: 100%;
}

body.showEditorSelection li.code-active-line:before,
body.showEditorSelection li.code-line:hover:before {
	left: -30px;
}

.vscode-light.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(0, 0, 0, 0.15);
}

.vscode-light.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(0, 0, 0, 0.40);
}

.vscode-light.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

.vscode-dark.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(255, 255, 255, 0.4);
}

.vscode-dark.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(255, 255, 255, 0.60);
}

.vscode-dark.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

.vscode-high-contrast.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(255, 160, 0, 0.7);
}

.vscode-high-contrast.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(255, 160, 0, 1);
}

.vscode-high-contrast.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

img {
	max-width: 100%;
	max-height: 100%;
}

a {
	text-decoration: none;
}

a:hover {
	text-decoration: underline;
}

a:focus,
input:focus,
select:focus,
textarea:focus {
	outline: 1px solid -webkit-focus-ring-color;
	outline-offset: -1px;
}

hr {
	border: 0;
	height: 2px;
	border-bottom: 2px solid;
}

h1 {
	padding-bottom: 0.3em;
	line-height: 1.2;
	border-bottom-width: 1px;
	border-bottom-style: solid;
}

h1, h2, h3 {
	font-weight: normal;
}

table {
	border-collapse: collapse;
}

table > thead > tr > th {
	text-align: left;
	border-bottom: 1px solid;
}

table > thead > tr > th,
table > thead > tr > td,
table > tbody > tr > th,
table > tbody > tr > td {
	padding: 5px 10px;
}

table > tbody > tr + tr > td {
	border-top: 1px solid;
}

blockquote {
	margin: 0 7px 0 5px;
	padding: 0 16px 0 10px;
	border-left-width: 5px;
	border-left-style: solid;
}

code {
	font-family: Menlo, Monaco, Consolas, "Droid Sans Mono", "Courier New", monospace, "Droid Sans Fallback";
	font-size: 1em;
	line-height: 1.357em;
}

body.wordWrap pre {
	white-space: pre-wrap;
}

pre:not(.hljs),
pre.hljs code > div {
	padding: 16px;
	border-radius: 3px;
	overflow: auto;
}

pre code {
	color: var(--vscode-editor-foreground);
	tab-size: 4;
}

/** Theming */

.vscode-light pre {
	background-color: rgba(220, 220, 220, 0.4);
}

.vscode-dark pre {
	background-color: rgba(10, 10, 10, 0.4);
}

.vscode-high-contrast pre {
	background-color: rgb(0, 0, 0);
}

.vscode-high-contrast h1 {
	border-color: rgb(0, 0, 0);
}

.vscode-light table > thead > tr > th {
	border-color: rgba(0, 0, 0, 0.69);
}

.vscode-dark table > thead > tr > th {
	border-color: rgba(255, 255, 255, 0.69);
}

.vscode-light h1,
.vscode-light hr,
.vscode-light table > tbody > tr + tr > td {
	border-color: rgba(0, 0, 0, 0.18);
}

.vscode-dark h1,
.vscode-dark hr,
.vscode-dark table > tbody > tr + tr > td {
	border-color: rgba(255, 255, 255, 0.18);
}

</style>

<style>
/* Tomorrow Theme */
/* http://jmblog.github.com/color-themes-for-google-code-highlightjs */
/* Original theme - https://github.com/chriskempson/tomorrow-theme */

/* Tomorrow Comment */
.hljs-comment,
.hljs-quote {
	color: #8e908c;
}

/* Tomorrow Red */
.hljs-variable,
.hljs-template-variable,
.hljs-tag,
.hljs-name,
.hljs-selector-id,
.hljs-selector-class,
.hljs-regexp,
.hljs-deletion {
	color: #c82829;
}

/* Tomorrow Orange */
.hljs-number,
.hljs-built_in,
.hljs-builtin-name,
.hljs-literal,
.hljs-type,
.hljs-params,
.hljs-meta,
.hljs-link {
	color: #f5871f;
}

/* Tomorrow Yellow */
.hljs-attribute {
	color: #eab700;
}

/* Tomorrow Green */
.hljs-string,
.hljs-symbol,
.hljs-bullet,
.hljs-addition {
	color: #718c00;
}

/* Tomorrow Blue */
.hljs-title,
.hljs-section {
	color: #4271ae;
}

/* Tomorrow Purple */
.hljs-keyword,
.hljs-selector-tag {
	color: #8959a8;
}

.hljs {
	display: block;
	overflow-x: auto;
	color: #4d4d4c;
	padding: 0.5em;
}

.hljs-emphasis {
	font-style: italic;
}

.hljs-strong {
	font-weight: bold;
}
</style>

<style>
/*
 * Markdown PDF CSS
 */

 body {
	font-family: -apple-system, BlinkMacSystemFont, "Segoe WPC", "Segoe UI", "Ubuntu", "Droid Sans", sans-serif, "Meiryo";
	padding: 0 12px;
}

pre {
	background-color: #f8f8f8;
	border: 1px solid #cccccc;
	border-radius: 3px;
	overflow-x: auto;
	white-space: pre-wrap;
	overflow-wrap: break-word;
}

pre:not(.hljs) {
	padding: 23px;
	line-height: 19px;
}

blockquote {
	background: rgba(127, 127, 127, 0.1);
	border-color: rgba(0, 122, 204, 0.5);
}

.emoji {
	height: 1.4em;
}

code {
	font-size: 14px;
	line-height: 19px;
}

/* for inline code */
:not(pre):not(.hljs) > code {
	color: #C9AE75; /* Change the old color so it seems less like an error */
	font-size: inherit;
}

/* Page Break : use <div class="page"/> to insert page break
-------------------------------------------------------- */
.page {
	page-break-after: always;
}

</style>

<script src="https://unpkg.com/mermaid/dist/mermaid.min.js"></script>
</head>
<body>
  <script>
    mermaid.initialize({
      startOnLoad: true,
      theme: document.body.classList.contains('vscode-dark') || document.body.classList.contains('vscode-high-contrast')
          ? 'dark'
          : 'default'
    });
  </script>
<h1 id="ad1-%E2%80%93-automated-email--document-processing">ad1 â€“ Automated Email &amp; Document Processing</h1>
<h2 id="overview">Overview</h2>
<p>ad1 is a secure, modular platform for automated email and document processing, designed to meet strict Swiss and EU compliance requirements. The system leverages intelligent agents, a persistent PostgreSQL database, audit trails, and a WebSocket-based chat for workflow orchestration. All components are hosted in Switzerland or on Swiss-compliant infrastructure, supporting both on-prem and cloud GPU options.</p>
<h2 id="client-requirements-from-briefing-multiagentmd">Client Requirements (from briefing multiagent.md)</h2>
<ul>
<li><strong>Swiss Hosting &amp; Compliance</strong>: All components (including LLMs) are hosted in Switzerland or with providers guaranteeing data residency in CH. GDPR, Swiss DSGVO, and AI law compliance are enforced. Role-based access, audit trails, and data retention policies are implemented.</li>
<li><strong>Open-Source LLMs</strong>: Only open-source LLMs are used, either self-hosted or via Swiss providers (e.g., SwissGPT, Infomaniak, Kvant). Optionally, a fully self-hosted LLM stack (e.g., LLaMA, Mistral) can be deployed.</li>
<li><strong>Orchestration</strong>: Workflows are orchestrated by a daemon and can be triggered via chat (Catbot) or automatically on new email arrival. n8n is referenced for orchestration, but the system is modular and can integrate with other orchestrators if needed.</li>
<li><strong>Agent Layer</strong>: Agents handle context tracking, compliance checking, document/report generation, and validation. After each processing step, human-in-the-loop validation is enforced.</li>
<li><strong>Input/Output</strong>: Supports ingestion of emails, PDFs, Word, and Excel files. Output includes processed documents, validation status, and audit logs. Finalized documents are encrypted and sent via email.</li>
<li><strong>Scalability</strong>: The architecture is modular and decoupled, allowing for easy extension with new templates, data sources, or AI models.</li>
</ul>
<h2 id="technical-architecture">Technical Architecture</h2>
<ul>
<li><strong>Daemon for Email API</strong>: Monitors the inbox (via MCP server), ingests new emails, and updates the task section in the database. Each relevant email or document becomes a processing task.</li>
<li><strong>Task &amp; Document Workflow</strong>: All documents to be processed are tracked as tasks in the database. Each task has a status (pending, processing, needs validation, validated, failed) and links to the original and processed files.</li>
<li><strong>Human-in-the-Loop Validation</strong>: After agent processing, tasks require manual validation. The validation UI displays the original document (left) and the processed result (right, including extracted values and handwriting recognition). Below are buttons to abort, restart (with prompt), or validate the task.</li>
<li><strong>Audit Trail</strong>: Every action (processing, validation, abort, etc.) is logged for compliance and traceability. Audit logs are visible in the UI.</li>
<li><strong>Encryption &amp; Secure Email Sending</strong>: Once validated, documents are encrypted and sent via email. All transmission and storage is secured.</li>
<li><strong>Extensible Model Integration</strong>: For handwriting and advanced document recognition, a dedicated model is used (self-hosted or via a Swiss provider). The system is modular for future model or provider swaps.</li>
</ul>
<h2 id="workflow">Workflow</h2>
<ol>
<li><strong>Email Ingestion</strong>: Daemon fetches and classifies new emails, creating tasks for relevant documents.</li>
<li><strong>Document Processing</strong>: Documents are processed by agents (including handwriting/field extraction).</li>
<li><strong>Validation</strong>: Human validates the processed result in the Validation UI (original left, processed right, action buttons below).</li>
<li><strong>Audit Logging</strong>: All actions are logged and visible in the Audit Trail UI.</li>
<li><strong>Encryption &amp; Sending</strong>: On validation, the document is encrypted and sent via email.</li>
<li><strong>Status Tracking</strong>: Task status is updated throughout; users can see and manage all tasks.</li>
</ol>
<h2 id="api-overview">API Overview</h2>
<ul>
<li><code>/api/emails</code> â€“ List, detail, and label emails</li>
<li><code>/api/documents</code> â€“ Upload, list, and process documents</li>
<li><code>/api/validation</code> â€“ Manage validation tasks (approve, abort, restart)</li>
<li><code>/api/audit</code> â€“ View audit logs</li>
<li><code>/ws/agent</code> â€“ WebSocket chat for agent interaction</li>
</ul>
<h2 id="frontend-structure">Frontend Structure</h2>
<ul>
<li><strong>Inbox</strong>: List and filter all emails, see processing status, trigger workflows, and label emails.</li>
<li><strong>Documents</strong>: Upload, view, and manage documents. See processing status and link to validation.</li>
<li><strong>Validation</strong>: Human-in-the-loop validation interface. Left: original document; Right: processed result (fields, handwriting, etc.). Below: Approve, abort, or restart with prompt. Audit trail for each task is visible. On validation, document is encrypted and sent.</li>
<li><strong>Audit Trail</strong>: View all actions and changes for compliance.</li>
<li><strong>Agent Chat</strong>: WebSocket chat to trigger workflows, ask for status, or interact with Catbot.</li>
<li><strong>Task Section</strong>: Overview of all processing tasks, their status, and actions (select, validate, abort, etc.).</li>
</ul>
<h2 id="security--compliance">Security &amp; Compliance</h2>
<ul>
<li>All data and servers are hosted in Switzerland (Google Cloud CH, on-prem, or Swiss providers)</li>
<li>Encryption for data at rest and in transit</li>
<li>GDPR, Swiss DSGVO, and AI law compliance</li>
<li>Role-based access and audit trails</li>
</ul>
<h2 id="quick-start">Quick Start</h2>
<ol>
<li><strong>Requirements</strong>: Docker, Docker Compose</li>
<li><strong>Start the system</strong>:<pre class="hljs"><code><div>docker compose up --build
</div></code></pre>
</li>
<li><strong>Frontend</strong>: Start with <code>npm run dev</code> in the <code>frontend/</code> directory (if developing locally)</li>
<li><strong>Database</strong>: Initialized automatically</li>
</ol>
<h2 id="file-structure">File Structure</h2>
<ul>
<li><code>backend/</code> â€“ FastAPI backend (agents, email, document, validation, audit)</li>
<li><code>frontend/</code> â€“ React/Vite frontend (Inbox, Documents, Validation, Audit, Chat, Tasks)</li>
<li><code>db/</code> â€“ Database initialization scripts</li>
<li><code>mcp/</code> â€“ MCP server for email integration</li>
</ul>
<hr>
<p>For more details, see the API documentation and the <code>briefing multiagent.md</code> file.</p>

</body>
</html>
